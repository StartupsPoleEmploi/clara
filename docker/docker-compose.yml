version: "2.3"
services:
  # nginx: 
  #   restart: always
  #   build:
  #     context: .
  #     dockerfile: dockerfile_nginx
  #   ports:
  #     - "80:80"

  myapp: 
    build:
      context: .
      dockerfile: dockerfile_rails
    volumes:
      # - '../../clara/docker/gemfiles:/home/clara'
      # Git repository of the application
      - '../../clara:/var/git/ara.git'
      # Environment variables
      - '../../clara/.env:/home/clara/.env'
      # Need to connect itself to ssh to deploy app locally
      - '../../clara/docker/.ssh:/root/.ssh'
    links:
      - db
    command: >
      sh -c "cd /var/git/ara.git &&
             bundle install &&
             service ssh restart &&
             echo 'My app launched !!!' &&
             sleep infinity"

# See https://stackoverflow.com/a/16651742/2595513
  
  db:
    image: postgres:9.5.17
    ports:
      - "5432:5432"

