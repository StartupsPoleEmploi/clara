- v = view_object(:result_default, local_assigns)

%script#emptyTemplate.u-hidden{:type => "text/ko-template"}
  <div></div>

%script#filtertagTemplate.u-hidden{:type => "text/ko-template"}
  :plain
    <div class="c-filterstag__item">
      <div class="c-filtertag">
        <div class="u-lrbox">
          <div class="u-lrbox__alignleft c-filtertag__text" data-bind="text: name"></div>
          <div class="u-lrbox__alignright c-filtertag__close" data-bind="click: tagClosed">
            &nbsp;&#x2716;
          </div>
          <div style="clear: both;">
        </div>
      </div>
    </div>

.c-result-default.o-wrapper
  .o-layout
    %div{class:"o-layout__item u-1/1 u-1/4@tablet"}


      %div.c-filterings-area
        %button.c-mask-filter.u-padding-vertical-small
          Masquer les filtres <span>&nbsp;&or;</span>        
            
        %fieldset.c-resultfilterings
          %legend.u-padding-vertical-small.u-padding-left-small Chercher les aides pour
          #o_all_filters{"data-bind" => "foreachInit: {data: o_all_filters, name: 'emptyTemplate' }"}
            - flat_all_filter.each_with_index do |a_filter, i|
              %div.c-resultfiltering.u-padding-small{class:"#{'c-resultfiltering--even' if (i%2 == 0)}"}
                %input{:id => "check_#{i}", :name => "newsletter", :type => "checkbox", "data-bind" => "checked: isActive"}/
                %label.u-margin-left-small{"for" => "check_#{i}"}=a_filter["description"]

    %div{class:"o-layout__item u-1/1 u-3/4@tablet"}


      #o_filterstag{"class" => "u-visually-hidden", "data-bind" => "with: o_filterstag"}
        .c-filterstag-container{"data-bind" => "css: o_cssMargin"}
          .c-filterstag.u-text--left{"data-bind" => "foreachInit: {data: o_active_filters, name: 'filtertagTemplate' }"}
    

      


      #o_eligibles{"data-bind" => "with: o_eligibles"}
        .u-lrbox
          .u-lrbox__alignleft
            %h3="Vous pouvez bénéficier de"
          .u-lrbox__alignright
            %button.c-btn.c-btn--small.c-btn--result{"data-bind" => "click: sesameOpen, css: foldClass"}
              Tout déplier <span class="c-resultcaret"><strong>&nbsp;&or;</strong></span>
            %button.c-btn.c-btn--small.c-btn--result{"data-bind" => "click: sesameClose, css: unfoldClass"}
              Tout replier <span class="c-resultcaret"><strong>&nbsp;&and;</strong></span>
          %div{:style => "clear: both;"}
        #o_aids_per_contract{"data-bind" => "foreachInit: {data: o_aids_per_contract, name: 'emptyTemplate' }"}
          - v.sort_and_order("flat_all_eligible").each_with_index do |aids_per_contract, i|
            .c-resultcard.c-resultcard--green{class:"#{'c-resultcard--notfirst' if i != 0}", "data-cslug" => v.slug_for(aids_per_contract), "data-bind" => "css: displayClass"}
              .c-resultcard__inner.o-layout.o-layout--middle.o-layout--flush
                %div{class:"o-layout__item u-3/4"}   
                  .o-flag.o-flag--flush.c-resultcontract
                    .o-flag__img{class:"u-hide-until@tablet"}
                      =v.icon_for(aids_per_contract)
                    .o-flag__body
                      %h4.c-resultcontract-title
                        %span.c-resultcontract-title__number{"data-bind" => "text: numberOfAidsPerContract"}
                          12
                        %span.c-resultcontract-title__text
                          =v.title_for(aids_per_contract)
                      %p.c-resultcontract_descr
                        =v.descr_for(aids_per_contract)
                %div{"class"=>"o-layout__item u-1/4 u-text--right", "aria-hidden"=>"true"}   
                  %button.c-btn.c-btn--small.c-btn--result{"data-bind" => "click: clickedOpenClose, css: closedClass"} Ouvrir <span class="c-resultcaret"><strong>&nbsp;&or;</strong></span>
                  %button.c-btn.c-btn--small.c-btn--result{"data-bind" => "click: clickedOpenClose, css: openedClass"} Replier <span class="c-resultcaret"><strong>&nbsp;&and;</strong></span>
              .c-resultaids{"data-bind" => "css: openedClass, foreachInit: {data: o_aids, name: 'emptyTemplate' }"}
                - aids_per_contract.each do |aid|
                  .c-resultaid{"data-aslug" => aid["slug"], "data-bind" => "css: visibleClass"}
                    .o-layout.o-layout--middle.o-layout--flush
                      %div{class:"o-layout__item u-3/4"}   
                        %h5=aid["name"]
                        %p=aid["short_description"]
                        %ul.o-list-inline{"data-bind" => "css: filtersClass"}
                          - v.filters_of(aid).each do |one_filter|
                            %li.o-list-inline__item.c-resultfilter.u-margin-top-tiny{"data-name" => one_filter["name"]}=one_filter["description"]
                      %div{class:"o-layout__item u-1/4 u-text--right"}
                        %button.c-btn.c-btn--primary.c-btn--aid{class:"u-padding-vertical-tiny@desktop u-padding-horizontal@desktop"}  En savoir plus
      





      .c-result-warning
        %p.c-result-warning__line Simulation non contractuelle tenant compte des éléments déclarés et appréciés le #{Time.now.strftime("%d/%m/%Y")}
        %p.c-result-warning__line Clara n'intègre pas encore les spécificités des aides et mesures applicables dans les régions et collectivités d'Outre Mer.
                  
